# ICPEx Liquidity Adapator
## 1. Add public pool liquidity
### 1.1 Description
1. First, acquire the canisterId of the Pool. 
2. Get the input amount required to add liquidity by calling the queryAddShareBase/queryAddShareQuote method on the router canister.
3. If the ICRC-1 standard is used, the amount of liquidity to be added needs to be transferred to the sub-account under the router(PID:2ackz-dyaaa-aaaam-ab5eq-cai). The sub-account is generated by the caller's PID.
4. Call the addLiquidity method on the router canister.
## 1.2 Endpoint - queryAddShareBase/queryAddShareQuote
* Canister PID: 2ackz-dyaaa-aaaam-ab5eq-cai
* Candid:
```candid
  //input base amount
  queryAddShareBase : (nat, principal) -> (nat, nat, nat, nat) query;
  //input quote amount
  queryAddShareQuote : (nat, principal) -> (nat, nat, nat, nat) query;
```

* Request parameters:

| Order | Name              | 	Description                                                                                                                                                                                                          |
|-------|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1     | base/quote_amount | 	the input base/quote amount                                                                                                                                                                                                     |
| 2     | pool_id           | 	pool canister id                                                                                                                                                                                            |


* Response parameters:

| Order | Name         | 	Description                                         |
|-------|--------------|------------------------------------------------------|
  | 1     | base_input   | 	The amount of base token required to add liquidity  |
  | 2     | quote_input  | 		The amount of base token required to add liquidity |
| 3     | shares       | 		The amount of LP used for adding liquidity.        |
| 4     | total_shares | 		Total LP amount after adding liquidity             |



## 1.3 Endpoint - addLiquidity
* Canister PID: 2ackz-dyaaa-aaaam-ab5eq-cai
* Candid:
```candid
    addLiquidity : (principal, nat, nat, nat, nat64) -> (nat, nat, nat);
```

* Request parameters:

| Order | Name            | 	Description                                                                                                                    |
|-------|-----------------|---------------------------------------------------------------------------------------------------------------------------------|
| 1     | pool_addr       | 	The canisterId of the pool to which liquidity is to be added                                                                   |
| 2     | base_in_amount  | 	The amount of base token required to add liquidity                                                                             |
| 3     | quote_in_amount | 	The amount of quote token required to add liquidity                                                                            |
| 4     | slippage | 	Trading slippage, with 18-digit precision. If the slippage exceeds the limit when adding liquidity, the transaction will fail. |
| 5     | deadline | 	Add liquidity deadline. Unit: nanoseconds                                                                                      |

* Response parameters:

| Order | Name            | 	Description                                                  |
|-------|-----------------|---------------------------------------------------------------|
| 1     | shares| 	The actual amount of LP used for adding liquidity.    |
| 2     | base_adjusted_in_amount  | 	The actual amount of base token required to add liquidity    |
| 3     | quote_adjusted_in_amount | 	The actual amount of quote token required to add liquidity   |



## 2. Removing LP
### 2.1 Description
Removing liquidity endpoint.
### 2.2 Endpoint - querySellShares
* Canister PID: 2ackz-dyaaa-aaaam-ab5eq-cai
* Candid:
```candid
  querySellShares : (nat, principal, principal) -> (nat, nat, nat, nat) query;
```
* Request parameters:

  
| Order | Name            | 	Description                                                                                                                    |
|-------|-----------------|---------------------------------------------------------------------------------------------------------------------------------|
| 1     | share_rate       | 	Proportion to be removed.  |
| 2     | owner  | 	The PID of the user holding the LP.                                                                             |
| 3     | pool_addr  | 	The canister ID of the pool where the LP needs to be removed.        |


* Response parameters:

| Order | Name            | 	Description                                                  |
|-------|-----------------|---------------------------------------------------------------|
| 1     | base_amount| 	The amount of base token to be removed.    |
| 2     | quote_amount  | 	The amount of quote token to be removed.   |
| 3     | lp_amount | 	The amount of LP to be removed.   |
| 4     | total_lp_amount | 	The actual amount of the total LP.   |

### 2.3 Endpoint - sellShares
* Canister PID: 2ackz-dyaaa-aaaam-ab5eq-cai
* Candid:
```candid
    sellShares : (nat, principal, nat, nat, nat, nat64) -> (nat, nat);
```
* Request parameters:

  
| Order | Name            | 	Description                                                                                                                    |
|-------|-----------------|---------------------------------------------------------------------------------------------------------------------------------|
| 1     | share_amount       | 	The amount of LP to be removed.   |
| 2     | pool_addr  | 		The canister ID of the pool where the LP needs to be removed.                                                                              |
| 3     | base_amount  | 	The amount of baseToken  want to receive.        |
| 4     | quote_amount  | 	The amount of quoteToken want to receive.       |
| 5     | slippage  | 	Slippage, 18 decimal        |
| 6     | deadline  | 	Unit: nanosecond.      |


* Response parameters:

| Order | Name            | 	Description                                                  |
|-------|-----------------|---------------------------------------------------------------|
| 1     | receive_base_amount| 	Base amount received    |
| 2     | receive_quote_amount  | 	Quote amount received   |

## 3. Transfer LP
### 3.1 Description
Use this endpoint to transfer own LP to another user's.
### 3.2 Endpoint
* Canister PID: 2ackz-dyaaa-aaaam-ab5eq-cai
* Candid:
```candid
      type Result_2 = variant { Ok; Err : text };
      transferLiquidity : (principal, principal, nat) -> (Result_2);
```
* Request parameters:

  
| Order | Name            | 	Description                                                                                                                    |
|-------|-----------------|---------------------------------------------------------------------------------------------------------------------------------|
| 1     | pool_addr       | 	The canister ID of the pool where the LP needs to be transferred.  |
| 2     | to  | 	The PID of the user receiving the LP.                                                                             |
| 3     | transfer_percent  | 	The ratio of LP being transferred, with a precision of 18. For example, the number for 50% would be 500000000000000000.        |


## 4. Lock LP
### 4.1 Description
Use this endpoint to lock own LP. LP will be transferred to the blackhole address(aaaaa-aa)
### 4.2 Endpoint
* Canister PID: 2ackz-dyaaa-aaaam-ab5eq-cai
* Candid:
```candid
      type Result_2 = variant { Ok; Err : text };
      lockLiquidity : (principal, nat, nat64) -> (Result_2);
```
* Request parameters:

| Order | Name            | 	Description                                                                                                                    |
|-------|-----------------|---------------------------------------------------------------------------------------------------------------------------------|
| 1     | pool_addr       | 	The canister ID of the pool where the LP needs to be locked.  |
| 2     | lock_percent  | 	The ratio of LP being locked, with a precision of 18. For example, the number for 50% would be 500000000000000000.        |
| 3     | expire_time  | 	Currently only supports 0, which means permanent lock.                                                                           |

